# imagepullsecret-patcher

A simple Kubernetes [client-go](https://github.com/kubernetes/client-go) application that creates and patches imagePullSecrets to service accounts in all Kubernetes namespaces to allow cluster-wide authenticated access to a container registry.  This can be useful when your clusters hit Docker's image download limit for anonymous/free user accounts.

![Version: 0.0.1](https://img.shields.io/badge/Version-0.0.1-informational?style=flat-square) ![Type: application](https://img.shields.io/badge/Type-application-informational?style=flat-square) ![AppVersion: 0.0.1](https://img.shields.io/badge/AppVersion-0.0.1-informational?style=flat-square)

Original code from https://github.com/titansoft-pte-ltd/imagepullsecret-patcher.
A blog post about their work: https://medium.com/titansoft-engineering/kubernetes-cluster-wide-access-to-private-container-registry-with-imagepullsecret-patcher-b8b8fb79f7e5

## Installation and configuration

### Install with Helm
```
helm repo add helxplatform https://helxplatform.github.io/devops/charts
helm inspect values helxplatform/imagepullsecret-patcher > my-values.yaml
# Add credentials in imageCredentials section in my-values.yaml
helm install imagepullsecret-patcher helxplatform/imagepullsecret-patcher --values my-values.yaml
```

## Values

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| affinity | object | `{}` |  |
| config.allserviceaccount | bool | `false` | if true, list and patch all service accounts and theÂ -servicesaccounts argument is ignored |
| config.debug | bool | `false` | show DEBUG logs |
| config.dockerconfigjson | string | `""` | json credential for authenicating container registry |
| config.dockerconfigjsonpath | string | `"/app/secrets/.dockerconfigjson"` | path for of mounted json credentials for dynamic secret management |
| config.excludednamespaces | string | `""` | comma-separated namespaces excluded from processing |
| config.force | bool | `true` | overwrite secrets when they do not match |
| config.loopduration | string | `"10s"` | duration string which defines how often namespaces are checked, see https://golang.org/pkg/time/#ParseDuration for more examples |
| config.managedonly | bool | `false` | only modify secrets which were created by imagepullsecret |
| config.runonce | bool | `false` | run the update loop once, allowing for cronjob scheduling if desired |
| config.secretname | string | `"image-pull-secret"` | name of managed secrets |
| config.serviceaccounts | string | `"default"` | comma-separated list of serviceaccounts to patch |
| fullnameOverride | string | `""` |  |
| image.pullPolicy | string | `"IfNotPresent"` |  |
| image.repository | string | `"helxplatform/imagepullsecret-patcher"` |  |
| imageCredentials.email | string | `nil` | email for registry |
| imageCredentials.password | string | `nil` | password for registry |
| imageCredentials.registry | string | `"https://index.docker.io/v1/"` | default image registry |
| imageCredentials.username | string | `nil` | username for registry |
| imagePullSecrets | list | `[]` |  |
| nameOverride | string | `""` |  |
| nodeSelector | object | `{}` |  |
| podAnnotations | object | `{}` |  |
| podSecurityContext | object | `{}` |  |
| replicaCount | int | `1` |  |
| resources.limits.cpu | float | `0.2` |  |
| resources.limits.memory | string | `"30Mi"` |  |
| resources.requests.cpu | float | `0.1` |  |
| resources.requests.memory | string | `"15Mi"` |  |
| securityContext | object | `{}` |  |
| serviceAccount.annotations | object | `{}` |  |
| serviceAccount.create | bool | `true` |  |
| serviceAccount.name | string | `""` |  |
| tolerations | list | `[]` |  |

And here are the annotations available:

| Annotation                                        | Object    | Description                                                                                                       |
| ------------------------------------------------- | --------- | ----------------------------------------------------------------------------------------------------------------- |
| k8s.titansoft.com/imagepullsecret-patcher-exclude | namespace | If a namespace has this annotation with a value set to "true", it will be excluded from processing by imagepullsecret-patcher. |

----------------------------------------------
Autogenerated from chart metadata using [helm-docs v1.5.0](https://github.com/norwoodj/helm-docs/releases/v1.5.0)
